import{x as e,c as t,g as o,h as n,k as l,p as i,i as s,y as a,q as r,j as c,t as d,r as u,o as m,b as _,e as v,z as p,u as f,l as h,A as x,w,n as y,s as g,B as b,F as k,m as E,a as L,C as M,D as S,E as C,G as V,v as T}from"./runtime-dom.esm-bundler-90e72f46.js";import{T as U,c as q,l as $,i as j,g as I,a as O,s as A,d as B,b as R,e as N,r as D,f as P,h as F,j as z,k as G,n as W,o as J,u as H,p as K,q as X,t as Q,v as Y}from"./util-ff1b650c.js";import{v as Z,x as ee}from"./index-9000aff5.js";import{_ as te,J as oe,s as ne,i as le}from"./Jsq-4d01198b.js";import{g as ie,o as se,i as ae,a as re,b as ce,c as de,d as ue,I as me,e as _e,G as ve}from"./stat-e9139785.js";import{o as pe,a as fe,s as he,g as xe,d as we}from"./tool-13238bfa.js";const ye={key:0},ge={key:0,class:"modal-header"},be={class:"modal-title"},ke={class:"modal-body"},Ee={key:1,class:"modal-footer"},Le=["disabled"],Me={class:"ok-icon-container"},Se={key:0,class:"modal-loading-icon"},Ce=te({__name:"Modal",props:{modelValue:{type:Boolean,default:!1},title:{type:String,default:"对话框"},width:{type:[String,Number],default:"400px"},okText:{type:String,default:"确定"},cancelText:{type:String,default:"取消"},showCancelButton:{type:Boolean,default:!0},closable:{type:Boolean,default:!0},maskClosable:{type:Boolean,default:!0},confirmLoading:{type:Boolean,default:!1},customClass:{type:String,default:""},showHeader:{type:Boolean,default:!0},showFooter:{type:Boolean,default:!0},position:{type:String,default:"center",validator:e=>["center","corner"].includes(e)},showMask:{type:Boolean,default:!0},closeOnOk:{type:Boolean,default:!0},handler:{type:Function,default:null},animation:{type:String,default:"fade",validator:e=>["slide","bounce","fade","flip","shake","slideUp"].includes(e)},teleportTarget:{type:String,default:"body"}},emits:["update:modelValue","ok","cancel","close"],setup(u,{emit:m}){const _=u,v=m;e();const p=()=>{v("update:modelValue",!1),v("close")},f=async()=>{if(v("ok"),"function"==typeof _.handler)try{await _.handler(),_.closeOnOk&&p()}catch(e){}else _.closeOnOk&&p()},h=()=>{v("cancel"),p()},x=t(()=>"number"==typeof _.width?_.width+"px":_.width);return(e,t)=>u.modelValue?(o(),n("div",ye,[u.showMask?(o(),n("div",{key:0,class:l(["modal-mask modal-4DB361DE-01F7-4376-B494-639E489D19ED",{"modal-mask-show":u.modelValue,"modal-mask-corner":"corner"===u.position}]),onClick:t[0]||(t[0]=e=>u.maskClosable?p():null)},null,2)):i("",!0),s("div",{class:l(["modal-wrapper",{"modal-wrapper-show":u.modelValue,"modal-wrapper-corner":"corner"===u.position,"modal-wrapper-no-mask":!u.showMask,[u.customClass]:u.customClass,["animation-"+u.animation]:"corner"===u.position}]),style:r({width:x.value})},[u.showHeader?(o(),n("div",ge,[s("div",be,[a(e.$slots,"title",{},()=>[c(d(u.title),1)],!0)]),u.closable?(o(),n("button",{key:0,class:"modal-close",onClick:p})):i("",!0)])):i("",!0),s("div",ke,[a(e.$slots,"default",{},void 0,!0)]),u.showFooter?(o(),n("div",Ee,[a(e.$slots,"footer",{},()=>[u.cancelText&&u.showCancelButton?(o(),n("button",{key:0,class:"modal-btn modal-btn-cancel",onClick:h},d(u.cancelText),1)):i("",!0),u.okText?(o(),n("button",{key:1,class:"modal-btn modal-btn-primary",onClick:f,disabled:u.confirmLoading},[a(e.$slots,"ok-button",{},()=>[s("span",Me,[a(e.$slots,"ok-icon",{},void 0,!0)]),u.confirmLoading?(o(),n("span",Se)):i("",!0),c(" "+d(u.okText),1)],!0)],8,Le)):i("",!0)],!0)])):i("",!0)],6)])):i("",!0)}},[["__scopeId","data-v-352ade69"]]);function Ve(e,t={}){const{timeout:o=8e3,mutationDebounce:n=500,idleTimeout:l=500,earlySuccessDelay:i=600}=t;let s=!1,a=null,r=null;const c={domMutation:!1,animationComplete:!1,idleTime:!1};function d(){return!!c.domMutation&&(s=!0,m(),e({allReady:!0,timedOut:!1,states:{...c}}),!0)}const u=function(e,t={}){const o="undefined"!=typeof document&&document&&document.body,{targetNode:n=(o?document.body:null),debounceTime:l=500,timeout:i=1e4,subtree:s=!0,childList:a=!0,attributes:r=!1,characterData:c=!0}=t;if(!n)return{stop:()=>{}};let d=null,u=null,m=0;const _=new MutationObserver(t=>{m+=t.length,clearTimeout(d),d=setTimeout(()=>{_.disconnect(),e({type:"mutation",stable:!0,changes:m,timedOut:!1})},l)});i&&(u=setTimeout(()=>{_.disconnect(),clearTimeout(d),e({type:"mutation",stable:!1,changes:m,timedOut:!0})},i));const v={subtree:s,childList:a,attributes:r,characterData:c};return _.observe(n,v),{stop:()=>{_.disconnect(),clearTimeout(d),clearTimeout(u)}}}(e=>{c.domMutation=e.stable,d()},{debounceTime:n,timeout:.8*o});function m(){a&&clearTimeout(a),r&&clearTimeout(r),u&&"function"==typeof u.stop&&u.stop()}return"undefined"!=typeof window&&window.requestIdleCallback?window.requestIdleCallback(()=>{c.idleTime=!0,d()},{timeout:l}):"undefined"!=typeof setTimeout&&setTimeout(()=>{c.idleTime=!0,d()},l),"undefined"!=typeof setTimeout&&(a=setTimeout(()=>{s||(m(),e({allReady:c.domMutation,timedOut:!0,partialSuccess:c.domMutation,states:{...c}}))},o)),function(){if("undefined"!=typeof document&&document&&document.body)try{const t=document.querySelectorAll('main, article, .content, [role="main"]');(t.length>0||document.body.textContent.trim().length>500)&&(r=setTimeout(()=>{s||(m(),e({allReady:!0,timedOut:!1,earlySuccess:!0,states:{...c}}))},i))}catch(t){}}(),{stop:m}}function Te({urls:e,groupName:t=(e=>{return null==(e=null==(t=null==document?void 0:document.title)?void 0:t.trim().split(/\s+/))?void 0:e[0];var t})()}){var o;const n={taskGroupName:t,tasks:e.map(e=>({url:U(e),size:0}))};let l="thunderx://"+JSON.stringify(n);"mac"===(null==(o=ie())?void 0:o.toLowerCase())&&(l="thunders://"+JSON.stringify(n)),q(l),se()}const Ue=()=>new Promise((e,t)=>{const o=Date.now();let n=0;const l=()=>{n++;const t=Date.now()-o;if(n>30||t>6e4)return void e(!1);const i=Array.from(document.querySelectorAll("button")).find(e=>e.textContent.trim().includes("Load more files"));i?(i.click(),setTimeout(l,500)):e(!0)};l()}),qe=()=>Array.from(document.querySelectorAll("a[download]")).filter(e=>e.href&&""!==e.href.trim()).map(e=>e.href),$e=()=>{const e=window.location.href,t=e.match(/\/([^\/]+)\/tree\/main/);if(t&&t[1])return t[1];const o=new URL(e).pathname.split("/"),n=o.indexOf("tree");return n>0?o[n-1]:o[o.length-1]||"unknown"},je=Object.freeze(Object.defineProperty({__proto__:null,downloadAllFiles:async()=>{try{await Ue();const e=qe();if(0===e.length)throw new Error("没有下载链接");return await Te({urls:e,groupName:$e()}),e}catch(e){throw $.error("huggingface-analyze 批量下载失败",e),e}},getDownloadUrls:qe,getFileName:$e,getIcon:()=>{const e=document.querySelector("h1");if(e){const t=e.querySelector("img");if(t)return t.src}},loadMore:Ue},Symbol.toStringTag,{value:"Module"})),Ie=()=>new Promise((e,t)=>{const o=Date.now();let n=0;const l=()=>{n++;const t=Date.now()-o;if(n>20||t>2e4)return void e(!1);const i=Array.from(document.querySelectorAll("button")).find(e=>e.textContent.trim().includes("Load more files"));i?(i.click(),setTimeout(l,500)):e(!0)};l()}),Oe=()=>Array.from(document.querySelectorAll("a[download]")).filter(e=>e.href&&""!==e.href.trim()).map(e=>e.href),Ae=()=>{const e=document.querySelector(".topTitleMark");if(e){const t=e.querySelector("div");if(t)return t.innerText}},Be=Object.freeze(Object.defineProperty({__proto__:null,downloadAllFiles:async()=>{try{await Ie();const e=Oe();return await Te({urls:e,groupName:Ae()}),e}catch(e){throw $.error("huggingface-analyze 批量下载失败",e),e}},getDownloadUrls:Oe,getFileName:Ae,getIcon:()=>{const e=document.querySelector(".topTitleMark");if(e){const t=e.querySelector("img");if(t)return t.src}},loadMore:Ie},Symbol.toStringTag,{value:"Module"})),Re={"huggingface.co":async()=>window.location.pathname.includes("/tree/main")?je:null,"modelscope.cn":async()=>window.location.pathname.includes("/files")?Be:null,"hf-mirror.com":async()=>window.location.pathname.includes("/tree/main")?je:null},Ne={container:"_container_wq4mj_4",title:"_title_wq4mj_8",badge:"_badge_wq4mj_28",downloadContent:"_downloadContent_wq4mj_38"},De=s("span",{class:"ok-icon-container"},null,-1),Pe=["src"],Fe=te({__name:"big-model",setup(e){const a=u(!1),r=u(null),c=u(""),h=u(""),x=u(""),w=u(!1),y=u(!1),g=u("initial"),b=t(()=>({initial:{title:c.value,icon:h.value,content:w.value?"使用迅雷一键下载全部文件，告别逐个下载！":y.value?"安装迅雷后，请刷新此页面！":"安装迅雷一键下载全部文件，告别逐个下载！",okText:w.value?"一键下载":"安装迅雷",cancelText:""},loading:{title:"正在加载模型全部文件列表，请稍候",icon:"",content:"如遇等待时间过长，请尝试刷新页面后，重新下载",okText:"",cancelText:"取消"},success:{title:"下载任务已创建",icon:"",content:"所有文件已添加到迅雷下载队列，可打开迅雷查看下载进度。",okText:"",cancelText:"关闭"},error:{title:"加载全部文件列表失败！",icon:"",content:'请尝试刷新页面后，重新点击"一键下载"',okText:"",cancelText:"关闭"}})),k=async()=>{if(!w.value)return await function(){if(!j)return S({name:"xl_install_thunder"},"Thunder installation").then(e=>e.success);window.open("https://mac.xunlei.com/","_blank")}(),V("install"),void(y.value=!0);try{g.value="loading",await r.value.downloadAllFiles(),a.value=!1,g.value="success",V("download")}catch(e){g.value="error",V("error")}},E=()=>{V("close"),M()};let L=null;function M(){a.value=!1,y.value=!1,g.value="initial"}function S(e,t="Chrome message"){return new Promise(t=>{chrome.runtime.sendMessage(e,e=>{chrome.runtime.lastError?t({success:!1,error:chrome.runtime.lastError}):t({success:!0,data:e})})})}async function C(){L&&(L.stop(),L=null);const e=window.location.hostname.split(".").slice(-2).join("."),t=await Re[e];if(!t)return r.value=null,void(a.value=!1);await async function(){var e;try{if(j){const e=await S({name:pe.CheckEnabled},"Mac Thunder installation check");return e.success&&e.data?(w.value=!!e.data.isInstallThunder,w.value):(w.value=!1,!1)}{const t=await S({name:"xl_check_installed"},"Thunder installation check"),o=t.success&&!!(null==(e=t.data)?void 0:e.version);return w.value=o,o}}catch(t){return w.value=!1,!1}}();const o=await t();if(!o)return r.value=null,void(a.value=!1);r.value=o;const{getFileName:n,getIcon:l}=r.value;try{i=e=>{if(e){e.allReady||e.timedOut;try{h.value=l(),c.value=n(),x.value=c.value,a.value=!0,V("show")}catch(t){}}},L="undefined"!=typeof document&&document&&document.body?Ve(e=>{e.allReady||(e.timedOut&&e.partialSuccess?e.allReady=!0:e.timedOut),i(e)},{timeout:8e3,mutationDebounce:500,earlySuccessDelay:600}):{stop:()=>{}}}catch(s){try{h.value=l(),c.value=n(),x.value=c.value,a.value=!0,V("show")}catch(d){}}var i}function V(e,t){let o=0,n={};switch(e){case"show":o=979,n={value5:c.value};break;case"download":o=980,n={value5:c.value,value6:"allclick_dl"};break;case"close":o=980,n={value5:c.value,value6:"close"};break;case"install":o=980,n={value5:c.value,value6:"install_xl"};break;case"error":o=981,n={value5:c.value}}chrome.runtime.sendMessage({name:"xl_stat",eventId:o,extParam:{...n}})}return m(()=>{"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{C()}):C();const e=function(){let e=window.location.pathname;const t=()=>{const t=window.location.pathname;t!==e&&(e=t,M(),C())};window.addEventListener("popstate",t),window.addEventListener("hashchange",t);const o=history.pushState,n=history.replaceState;history.pushState=function(...e){o.apply(this,e),t()},history.replaceState=function(...e){n.apply(this,e),t()};const l=setInterval(t,1e3);return window.addEventListener("focus",t),()=>{window.removeEventListener("popstate",t),window.removeEventListener("hashchange",t),window.removeEventListener("focus",t),clearInterval(l),history.pushState=o,history.replaceState=n}}();_(()=>{e(),L&&(L.stop(),L=null),M()})}),(e,t)=>(o(),n("div",{class:l(e.$style.container)},[v(f(Ce),{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value=e),title:"",width:360,okText:b.value[g.value].okText,cancelText:b.value[g.value].cancelText,customClass:"thunder-download-modal",position:"corner",showMask:!1,closeOnOk:!1,teleportTarget:"#xl-teleport-container",onOk:k,onClose:E},{"ok-icon":p(()=>[De]),title:p(()=>[s("div",{class:l(e.$style.title)},[b.value[g.value].icon?(o(),n("img",{key:0,src:b.value[g.value].icon,alt:"模型图标",width:"20",height:"20"},null,8,Pe)):i("",!0),s("span",{class:l(e.$style.badge)},d(b.value[g.value].title),3)],2)]),default:p(()=>[s("div",{class:l(e.$style.downloadContent)},[s("p",null,d(b.value[g.value].content),1)],2)]),_:1},8,["modelValue","okText","cancelText"])],2))}},[["__cssModules",{$style:Ne}]]),ze=["id"],Ge=["onClick"],We=te({__name:"content-mac",setup(e){const t="xl_chrome_ext_"+ee,a=u(Z),r=u(!1),c=u(!1),d=u(""),_=u(""),p=u([]),f=u(!1),x=u([]),w=u(!1),y=u(!1),g=()=>{$.info("downloadVideo",d.value),d.value&&chrome.runtime.sendMessage({name:pe.xl_download,linkUrl:_.value,refererUrl:document.location.href,cookie:document.cookie})};m(()=>{document.addEventListener("scroll",M),document.body.addEventListener("mousemove",S),window.self!==window.top&&document.body.addEventListener("mouseout",L),document.addEventListener("scroll",M),V()});const b=()=>{const e=document.getElementById(t);e&&(e.style.display="none")},k=()=>{const e=document.getElementById(t);e&&(e.remove(),document.body.removeEventListener("mousemove",S,!0),window.self!==window.top&&document.body.removeEventListener("mouseout",L),document.body.removeEventListener("scroll",M),d.value=null,_.value=void 0,p.value=[])},E=e=>{const o=document.getElementById(t);if(!o)return;o.style.display="block",c.value=!0;const n=e.getBoundingClientRect(),l=`position:fixed;left: ${n.x+4}px; top: ${n.y+4}px; height: 30px; z-index: 10000000000 !important`;o.style=l,w.value||(w.value=!0,chrome.runtime.sendMessage({name:pe.xl_video_show,referurl:document.location.href,videoSrc:e.src}))},L=e=>{if(d.value){const t=document.getElementById(Z).contains(e.toElement);t||(d.value=null,_.value=void 0,$.info("isToChildDom :>> ",t),b())}},M=()=>{d.value&&E(d.value)},S=e=>{const t=document.elementFromPoint(e.x,e.y);if(!t)return;if("video"===t.tagName.toLocaleLowerCase()){const e=t.src||I(t);if(!e||0===e.toLocaleLowerCase().indexOf("blob:"))return;if(t===d.value)return;return d.value=t,_.value=e,E(t),void $.info("video src",_.value)}if(d.value){if(!O(e,d.value))return d.value=null,_.value=void 0,void b()}else{let t=null;for(const o of p.value)if("none"!==window.getComputedStyle(o).display)if(O(e,o))if(t){(Number(window.getComputedStyle(o).zIndex)||0)>(Number(window.getComputedStyle(t).zIndex)||0)&&(t=o)}else t=o;else if(t){const e=t.src||I(t);e&&0!==e.toLowerCase().indexOf("blob:")&&(d.value=t,_.value=e,E(t))}if(t){const e=t.src||I(t);e&&0!==e.toLowerCase().indexOf("blob:")&&(d.value=t,_.value=e,E(t))}}},C=async()=>{chrome.runtime.sendMessage({name:pe.xl_call_function,method:fe.getWebsiteDomains},async e=>{x.value=new Set(await e.websiteDomains);const t=B.exec(document.location.host)[2];y.value=x.value.has(t),$.warn((f.value?"已安装xunlei":"未安装xunlei")+" "),$.info("isInWebsiteDomains",y.value),f.value&&!y.value&&(r.value=!0)})},V=async()=>{$.info("init"),await(async()=>{const e=await chrome.runtime.sendMessage({name:pe.CheckEnabled});e&&(f.value=e.isInstallThunder)})(),await C();const e=document.getElementsByTagName("video");p.value=e,$.info("==========allVideos.value",p.value.length,"=========="),!p.value.length>0||A(p.value)};return(e,t)=>(o(),n("div",{class:l([e.$style["content-wrapper"],e.$style["mac-content-wrapper"]]),id:a.value},[c.value?(o(),n("div",{key:0,class:l(e.$style["video-wrapper"])},[s("div",{class:l([e.$style["options-wrapper"]])},[s("div",{class:l(e.$style["xl-chrome-ext-bar__logo"])},null,2),s("div",{class:l([e.$style["xl-chrome-ext-tips"],e.$style.download]),onClick:h(g,["stop"])},[s("a",{id:"xl_chrome_ext_bar_download",class:l([e.$style["xl-chrome-ext-bar__option"]]),href:"javascript:;"},null,2),s("div",{class:l([e.$style["xl-chrome-ext-title"]])},"下载视频",2)],10,Ge),s("a",{id:"xl_chrome_ext_close",class:l([e.$style["xl-chrome-ext-bar__option"]]),title:"本次关闭",href:"javascript:;",onClick:k},[s("div",{class:l(["xl-close img",[e.$style["xl-close"],e.$style.img]])},null,2)],2)],2)],2)):i("",!0),v(Fe)],10,ze))}},[["__cssModules",{$style:{video_op_wrapper:"_video_op_wrapper_1aqct_1",video_op_list:"_video_op_list_1aqct_1",op_icon:"_op_icon_1aqct_1",op_text:"_op_text_1aqct_1",op_item:"_op_item_1aqct_1",download:"_download_1aqct_1",play:"_play_1aqct_1",screen:"_screen_1aqct_1","options-wrapper":"_options-wrapper_1aqct_20","xl-chrome-ext-bar-toast":"_xl-chrome-ext-bar-toast_1aqct_14","xl-chrome-ext-bar__logo":"_xl-chrome-ext-bar__logo_1aqct_1","xl-chrome-ext-bar-toast__success":"_xl-chrome-ext-bar-toast__success_1aqct_1","xl-chrome-ext-bar-toast__error":"_xl-chrome-ext-bar-toast__error_1aqct_1","xl-chrome-ext-bar-toast__text":"_xl-chrome-ext-bar-toast__text_1aqct_1","xl-chrome-ext-tips":"_xl-chrome-ext-tips_1aqct_1","xl-chrome-ext-title":"_xl-chrome-ext-title_1aqct_1","xl-chrome-ext-title--footer":"_xl-chrome-ext-title--footer_1aqct_1","xl-chrome-ext-bar__option":"_xl-chrome-ext-bar__option_1aqct_1",img:"_img_1aqct_1","xl-download":"_xl-download_1aqct_1","xl-screen":"_xl-screen_1aqct_1","xl-close":"_xl-close_1aqct_1","content-wrapper":"_content-wrapper_1aqct_3","video-wrapper":"_video-wrapper_1aqct_8","mac-content-wrapper":"_mac-content-wrapper_1aqct_11"}}]]);function Je(e){!function(e){chrome.runtime.sendMessage(e)}({name:"xl_prompt_click",...e})}const He=["id"],Ke={class:"xl-chrome-ext-dialog__title"},Xe=x('<ul class="xl-chrome-ext-dialog__content"><li class="xl-chrome-ext-dialog__content-li"><div class="xl-chrome-ext-dialog__content-icon xl-download"></div><div class="xl-chrome-ext-dialog__content-text">一键读取网页中的可下载链接</div></li><li class="xl-chrome-ext-dialog__content-li"><div class="xl-chrome-ext-dialog__content-icon xl-video"></div><div class="xl-chrome-ext-dialog__content-text">网页视频下载、存云盘、投屏播放</div></li><li class="xl-chrome-ext-dialog__content-li"><div class="xl-chrome-ext-dialog__content-icon xl-picture"></div><div class="xl-chrome-ext-dialog__content-text">批量下载图片</div></li></ul>',1),Qe={class:"xl-chrome-ext-dialog__footer"},Ye={__name:"ActionErrorDialog",props:{text:{type:String,required:!0}},emits:["submit","cancel"],setup(e){const t=u(R("action"));return m(async()=>{}),(l,i)=>(o(),n("div",{class:"xl-chrome-ext-dialog",id:t.value},[s("h2",Ke,"无法"+d(e.text)+"，请安装迅雷客户端后重试",1),s("a",{action:"close",href:"javascript:;",class:"xl-chrome-ext-dialog__close",title:"关闭",onClick:i[0]||(i[0]=h(e=>l.$emit("cancel","close"),["stop"]))}),Xe,s("div",Qe,[s("button",{onClick:i[1]||(i[1]=h(e=>l.$emit("submit","install"),["stop"])),action:"install",class:"xl-chrome-ext-dialog__button xl-download"}," 迅雷高速下载 "),s("button",{onClick:i[2]||(i[2]=e=>l.$emit("cancel","once-close")),action:"once-close",class:"xl-chrome-ext-dialog__button xl-close"}," 取消 ")])],8,He))}},Ze={animate__bounceOutUp:"_animate__bounceOutUp_ti0wz_29",bounceInUp:"_bounceInUp_ti0wz_1","xl-chrome-ext-footer__ball":"_xl-chrome-ext-footer__ball_ti0wz_33","xl-chrome-ext-footer__name":"_xl-chrome-ext-footer__name_ti0wz_50"},et={id:"xl-chrome-ext-footer",class:"xl-chrome-ext-footer"},tt=["onClick","onMouseenter","onMouseleave","onAnimationend"],ot=s("div",{class:"xl-chrome-ext-footer__logo"},null,-1),nt={class:"xl-chrome-ext-footer__quantity"},lt=["onMouseenter","onMouseleave","onAnimationend"],it={key:0,class:"xl-chrome-ext-footer__jsq"},st={class:"xl-chrome-ext-footer__content"},at={class:"xl-chrome-ext-footer__text"},rt={class:"xl-chrome-ext-footer__action"},ct=["onClick","onMouseenter","onMouseleave"],dt=s("h3",null,"用迅雷享高速下载",-1),ut=s("div",{class:"xl-chrome-ext-footer__explain"},"当前页面含资源如下：",-1),mt={class:"xl-chrome-ext-footer__list"},_t=["data","onClick"],vt=s("div",{class:"xl-chrome-ext-footer__action-name"},"下载",-1),pt=["onClick","onMouseenter","onMouseleave"],ft={class:"xl-chrome-ext-footer__action-name"},ht={class:"xl-chrome-ext-footer__button-text"},xt=s("h3",null,"存迅雷云盘，享高清播放、高速下载",-1),wt=s("div",{class:"xl-chrome-ext-footer__explain"},"当前页面含资源如下：",-1),yt={class:"xl-chrome-ext-footer__list"},gt=["onClick"],bt={class:"xl-chrome-ext-footer__button-text"},kt={key:0,class:"xl-chrome-ext-footer__agreement"},Et=s("span",null,"启用插件访问在线视频时，插件将在播放窗口展示对播放链接的快捷功能",-1),Lt=["onClick"],Mt={class:"xl-chrome-ext-footer__close-wrapper"},St={class:"xl-chrome-ext-tips"},Ct=["onClick"],Vt=s("div",{class:"xl-chrome-ext-title xl-chrome-ext-title--footer"},"本次关闭",-1),Tt=te({__name:"Footer",props:{resourceList:{type:Object,required:!0},exception:{type:Boolean,required:!0},isShowJsqEntry:{type:Boolean,required:!0},jsqText:{type:Object,required:!0},isRiskControlPassed:{type:Boolean,required:!1,default:!1}},emits:["removeFooter","showActionError","showVersionError","handleDownload","handleCloseBar"],setup(e,{emit:a}){const c=a,_=e,p=t(()=>_.isRiskControlPassed),f=u(null),x=u(!1),L=u(null),M=u(null),S=u(!1),C=u(!1),V=u(!1),T=u(0),U=u(0),q=u(null),$=u(null),j=u(!1),I=u(!0),O=u(_.resourceList.playList.length===_.resourceList.length),A=u(0===_.resourceList.saveList.length);function B(){x.value=!0,f.value=setTimeout(()=>{x.value=!1},5e3)}function R(){j.value=!0,_.resourceList.downloadList.length>0&&y(()=>{if(q.value){const{height:e}=window.getComputedStyle(q.value);T.value=`-${parseFloat(e)+16}px`}}),_.resourceList.saveList.length>0&&y(()=>{if($.value){const{height:e}=window.getComputedStyle($.value);U.value=`-${parseFloat(e)+16}px`}})}function N(e){return e.isInIframe&&".m3u8"===e.suffix&&(e.fileName=xe(e.suffix,e.url)),e.fileName}function D(){M.value=setTimeout(()=>{C.value=!1},300)}function P(){M.value&&clearTimeout(M.value),C.value=!0}function F(){W(_.resourceList.saveList[0])}function z(){L.value=setTimeout(()=>{V.value=!1},300)}function G(){L.value&&clearTimeout(L.value),V.value=!0}async function W(e){const t=e;if(_.exception)return c("showActionError","流畅播","fluent_play"),void chrome.runtime.sendMessage({name:"xl_cloudadd_stat",from:"bottom_bar",isSuccess:!1,data:t});if(t.isVideoURL){S.value=!0;const{isAccept:e}=await chrome.runtime.sendMessage({name:"xl_check_blacklist"});if(S.value=!1,!e)return chrome.runtime.sendMessage({name:"xl_show_toast",text:"链接异常，无法流畅播",type:"info"}),void chrome.runtime.sendMessage({name:"xl_cloudadd_stat",from:"bottom_bar",isSuccess:!1,data:t})}var o;(o=t).suffix&&chrome.runtime.sendMessage({name:"xl_cloudadd",from:"bottom_bar",data:{opt:"web:cloudadd",params:{url:o.url,name:o.fileName,ext:o.suffix,isVideo:o.isVideoURL,cookie:document.cookie,webTitle:document.title}},isM3U8Video:".m3u8"===o.suffix},e=>{e&&("version"===e.errType&&c("showVersionError",e.text),chrome.runtime.sendMessage({name:"xl_cloudadd_stat",from:"bottom_bar",isSuccess:e.result,data:o}))})}function J(){if(_.exception){c("showActionError","下载","download");const e=_.resourceList.downloadList[0];chrome.runtime.sendMessage({name:"xl_download_stat",link:e.url,stat:e.isVideoURL?"chrome_download_video":"chrome_download_other",from:"bottom_bar",status:"fail"})}else{H(_.resourceList.downloadList[0])}}function H(e){chrome.runtime.sendMessage({name:"xl_download",link:e.url,cookie:document.cookie,referurl:document.location.href,stat:e.isVideoURL?"chrome_download_video":"chrome_download_other",from:"bottom_bar",isM3U8Video:".m3u8"===e.suffix},e=>{e&&"version"===e.errType&&c("showVersionError",e.text)})}w(x,e=>{!0===e&&R()});const K=u(!0);function X(){chrome.runtime.sendMessage({name:"xl_footer_other_click",clickId:"close"}),c("removeFooter")}function Q(){chrome.storage.local.set({isAgreementVisible:!1}),I.value=!1}function Y(){const e=K.value?"fix_bar":"release_bar";K.value=!K.value,x.value=!K.value,chrome.runtime.sendMessage({name:"xl_footer_other_click",clickId:e})}function Z(){f.value&&clearTimeout(f.value),x.value||(x.value=!0)}function ee(){K.value&&(x.value=!1)}function te(){K.value&&(M.value=setTimeout(()=>{x.value=!1},800))}function ne(){f.value&&clearTimeout(f.value),M.value&&clearTimeout(M.value),K.value&&(x.value=!0)}function le(){const e=document.querySelector("#xl-chrome-ext-footer");if(!e.nextSibling)return;e.parentElement.appendChild(e)}return chrome.storage.local.get("isAgreementVisible",e=>{e&&!1===e.isAgreementVisible?I.value=!1:I.value=!0}),m(()=>{chrome.runtime.sendMessage({name:"xl_footer_show",url:document.location.href,downloadShow:0!==_.resourceList.downloadList.length?1:0,playShow:!A.value&&O.value?1:0,saveShow:A.value||O.value?0:1,resourceList:JSON.stringify(_.resourceList)}),he(le,3e5,!0)}),(t,a)=>g((o(),n("div",et,[s("div",{class:l(["",[t.$style.animate__bounceOutUp,t.$style["xl-chrome-ext-footer__ball"]]]),onClick:h(Y,["stop"]),onMouseenter:h(Z,["stop"]),onMouseleave:h(ee,["stop"]),onAnimationend:h(B,["stop"])},[ot,s("div",nt,d(e.resourceList.length),1)],42,tt),s("div",{onMouseenter:h(ne,["stop"]),onMouseleave:h(te,["stop"]),onAnimationend:h(R,["stop"]),class:l({"xl-chrome-ext-footer__bar":!0,"xl-chrome-ext-footer__bar--show":x.value})},[e.isShowJsqEntry?(o(),n("div",it,[v(oe,{source:"footer",text:e.jsqText},null,8,["text"])])):i("",!0),s("div",st,[s("p",at," 检测到页面存在 "+d(e.resourceList.length<=99?e.resourceList.length:99)+" 个资源 ",1),s("div",rt,[g(s("div",{class:"xl-chrome-ext-footer__url download",onClick:h(J,["stop"]),onMouseenter:h(P,["stop"]),onMouseleave:h(D,["stop"])},[e.resourceList.downloadList.length>0?(o(),n("div",{key:0,ref_key:"downloadPopoverRef",ref:q,style:r({top:T.value}),class:l({"xl-chrome-ext-footer__popover":!0,"xl-chrome-ext-footer__popover--show":C.value,"xl-chrome-ext-footer__popover--hidden":!C.value})},[dt,ut,s("ul",mt,[(o(!0),n(k,null,E(e.resourceList.downloadList,(e,i)=>(o(),n("li",{class:"xl-chrome-ext-footer__item",key:i},[s("div",{class:l({"xl-chrome-ext-footer__type":!0,"xl-video":e.isVideoURL,"xl-link":!e.isVideoURL})},null,2),s("div",{class:l(t.$style["xl-chrome-ext-footer__name"])},d(N(e)),3),s("button",{type:"download",data:JSON.stringify(e),onClick:h(t=>{return o=e,void(_.exception?(c("showActionError","下载","download"),chrome.runtime.sendMessage({name:"xl_download_stat",link:o.url,stat:o.isVideoURL?"chrome_download_video":"chrome_download_other",from:"bottom_bar",status:"fail"})):H(o));var o},["stop"])}," 下载 ",8,_t)]))),128))])],6)):i("",!0),vt],40,ct),[[b,e.resourceList.downloadList.length>0]]),e.resourceList.saveList.length>0?(o(),n("div",{key:0,class:"xl-chrome-ext-footer__url cloudAdd",onClick:h(F,["stop"]),onMouseenter:h(G,["stop"]),onMouseleave:h(z,["stop"])},[s("div",ft,[s("div",{class:l({"xl-chrome-ext-footer__button-icon":!0,loading:S.value,save:!O.value,play:!!O.value})},null,2),s("span",ht,d(S.value?"添加中":O.value?"流畅播":"存云盘"),1)]),e.resourceList.saveList.length>0?(o(),n("div",{key:0,ref_key:"cloudAddPopoverRef",ref:$,style:r({top:U.value}),class:l({"xl-chrome-ext-footer__popover":!0,"xl-chrome-ext-footer__popover--show":V.value,"xl-chrome-ext-footer__popover--hidden":!V.value})},[xt,wt,s("ul",yt,[(o(!0),n(k,null,E(e.resourceList.saveList,(e,i)=>(o(),n("li",{class:"xl-chrome-ext-footer__item",key:i},[s("div",{class:l({"xl-chrome-ext-footer__type":!0,"xl-video":e.isVideoURL,"xl-link":!e.isVideoURL})},null,2),s("div",{class:l(t.$style["xl-chrome-ext-footer__name"])},d(N(e)),3),s("button",{onClick:h(t=>function(e,t){W(t)}(0,e),["stop"])},[s("div",{class:l({"xl-chrome-ext-footer__button-icon":!0,small:!0,loading:S.value,save:!e.isVideoURL,play:!!e.isVideoURL})},null,2),s("span",bt,d(e.isVideoURL?"流畅播":"存云盘"),1)],8,gt)]))),128))])],6)):i("",!0)],40,pt)):i("",!0)]),I.value?(o(),n("div",kt,[Et,s("span",{class:"xl-chrome-ext-footer__know",onClick:h(Q,["stop"])},"我知道了",8,Lt)])):i("",!0),s("div",Mt,[s("div",St,[s("div",{class:"xl-chrome-ext-footer__close",onClick:h(X,["stop"])},null,8,Ct),Vt])])])],42,lt)],512)),[[b,p.value]])}},[["__cssModules",{$style:Ze}]]),Ut=["id"],qt=s("h2",{class:"xl-chrome-ext-dialog__title"},"浏览器无法直接打开磁力链等特殊格式链接",-1),$t=x('<ul class="xl-chrome-ext-dialog__content"><li class="xl-chrome-ext-dialog__content-li"><div class="xl-chrome-ext-dialog__content-icon xl-download"></div><div class="xl-chrome-ext-dialog__content-text">高速下载：基础加速、超级通道、会员加速三重加速</div></li><li class="xl-chrome-ext-dialog__content-li"><div class="xl-chrome-ext-dialog__content-icon xl-compatible"></div><div class="xl-chrome-ext-dialog__content-text">强大兼容：支持磁力、种子、在线视频</div></li><li class="xl-chrome-ext-dialog__content-li"><div class="xl-chrome-ext-dialog__content-icon xl-pan"></div><div class="xl-chrome-ext-dialog__content-text">超大云盘：最高12TB备份</div></li></ul>',1),jt={class:"xl-chrome-ext-dialog__footer"},It={__name:"ResourceDialog",emits:["submit","cancel"],setup(e){const t=u(R("resource"));return m(async()=>{}),(e,l)=>(o(),n("div",{class:"xl-chrome-ext-dialog",id:t.value},[qt,s("a",{action:"close",href:"javascript:;",class:"xl-chrome-ext-dialog__close",title:"关闭",onClick:l[0]||(l[0]=h(t=>e.$emit("cancel","close"),["stop"]))}),$t,s("div",jt,[s("button",{action:"install",class:"xl-chrome-ext-dialog__button xl-download",onClick:l[1]||(l[1]=h(t=>e.$emit("submit","install"),["stop"]))}," 迅雷高速下载 "),s("button",{action:"close",class:"xl-chrome-ext-dialog__button xl-close",onClick:l[2]||(l[2]=h(t=>e.$emit("cancel","close"),["stop"]))}," 取消 ")])],8,Ut))}};const Ot=new class{constructor(){this.options={enabled:!0,colors:{info:"#0000FF",warn:"#FFA500",error:"#FF0000",log:"#000000"}}}setEnabled(e){this.options.enabled=e}setColors(e){this.options.colors={...this.options.colors,...e}}logMessage(e,t,...o){if(!this.options.enabled)return;this.options.colors[e]}info(e,...t){this.logMessage("info",e,...t)}warn(e,...t){this.logMessage("warn",e,...t)}error(e,...t){this.logMessage("error",e,...t)}log(e,...t){this.logMessage("log",e,...t)}},At=["onMouseenter","onMouseleave","onClick"],Bt=te({__name:"link-badge-win",props:{exception:{type:Boolean,required:!0}},emits:["showActionError","showVersionError"],setup(e,{emit:t}){const i=t,a=e;u([]);const r="badge_wrapper_"+ee,c=u(null),d=u(null),v=u("");u(null);const p=u(!1);u({top:0,left:0}),u(1e3);const f=D;function x(){const e={link:v.value,stat:"chrome_download_other"};Ot.info("badge tag click",e),a.exception?i("showActionError","下载","download"):async function({link:e=""}){const t={link:e,stat:"chrome_download_other",isM3U8Video:!1};try{const e=await async function({fileName:e="",link:t="",stat:o=""}){return await chrome.runtime.sendMessage({name:"xl_download",link:t,fileName:e,cookie:document.cookie,referurl:document.location.href,stat:o,from:p.value?"text_hover":"link_hover",isInIframe:N(),isM3U8Video:!1})}(t);Ot.info("badge dl resp",e)}catch(o){"version"===(null==o?void 0:o.errType)&&(Ot.info("badge dl error",null==o?void 0:o.text),i("showVersionError",null==o?void 0:o.text))}}(e)}const w=()=>{Ot.log("enter badge浮层")},y=()=>{g()};function g(){try{c.value.style.display="none"}catch(e){Ot.warn("hideLinkPopover",e)}}const b=e=>{var t;const o=e.target,n=o.href||"",l=function(e){let t="";return e.childNodes.forEach(e=>{e.nodeType===Node.TEXT_NODE&&(t+=e.textContent.trim())}),t}(o),i=f.test(n),s=f.test(l),a=s?null==(t=l.match(f))?void 0:t[0]:"";(i||s)&&(e.preventDefault(),v.value=i?n:a,d.value=o,p.value=!i,function(e,t){const o=c.value;o.style.display="flex";const n=o.getBoundingClientRect(),l=t.getBoundingClientRect(),i=e.clientX-n.width/4,s=l.top-n.height;o.style.left=i+"px",o.style.top=s+"px"}(e,o),chrome.runtime.sendMessage({name:"xl_stat",eventId:977,extParam:{value2:v.value,value7:p.value?"text_hover":"link_hover"}}))};function k(e){var t;(null==(t=null==e?void 0:e.toElement)?void 0:t.id.includes(r))||e.target!==d.value||g()}return m(()=>{function e(){document.body.addEventListener("mouseenter",b,!0),document.body.addEventListener("mouseleave",k,!0)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{e()}):e()}),_(()=>{document.body.removeEventListener("mouseenter",b,!0),clearTimeout(null),Ot.info("link-badge onUnmounted")}),(e,t)=>(o(),n("div",{class:l([r,e.$style.badge_wrapper]),id:r,ref_key:"linkPopRef",ref:c,onMouseenter:h(w,["stop"]),onMouseleave:h(y,["stop"]),onClick:h(x,["stop"])},[s("div",{class:l(e.$style.logo)},null,2),s("span",{class:l(e.$style.line)},null,2),s("div",{class:l(e.$style.text_wrapper)},[s("span",{class:l(e.$style.download_icon)},null,2),s("span",{class:l(e.$style.text)},"高速下载",2)],2)],42,At))}},[["__cssModules",{$style:{badge_wrapper:"_badge_wrapper_wnbzb_1",logo:"_logo_wnbzb_24",line:"_line_wnbzb_32",text_wrapper:"_text_wrapper_wnbzb_39",download_icon:"_download_icon_wnbzb_51",text:"_text_wnbzb_39"}}]]),Rt={class:"dialog-wrapper xly-dialog-prompt"},Nt=[s("i",{class:"xl-icon-close"},null,-1)],Dt={class:"xly-dialog-prompt__text"},Pt=s("p",{class:"xly-dialog-prompt__text"},"（升级提示：主菜单-检查更新）",-1),Ft={class:"xly-dialog-prompt__footer"},zt={class:"xly-dialog-prompt__button"},Gt={__name:"VersionError",props:{text:{type:String,required:!0}},emits:["submit","cancel"],setup:(e,{emit:t})=>(m(async()=>{}),(t,l)=>(o(),n("div",Rt,[s("h2",null,d(e.text)+"调用失败",1),s("a",{action:"close",href:"javascript:;",onClick:l[0]||(l[0]=h(e=>t.$emit("cancel","close"),["stop"])),class:"xly-dialog-close",title:"关闭"},Nt),s("p",Dt,"客户端版本过低，无法启用"+d(e.text)+"。",1),Pt,s("div",Ft,[s("div",zt,[s("button",{action:"close",class:"td-button--other",style:{width:"65px","border-radius":"4px"},onClick:l[1]||(l[1]=e=>t.$emit("cancel","close"))}," 取消 "),s("button",{action:"startThunder",class:"td-button",onClick:l[2]||(l[2]=h(e=>t.$emit("submit","startThunder"),["stop"]))},"前往升级")])])])))},Wt={video_op_wrapper:"_video_op_wrapper_pujw6_1",video_op_list:"_video_op_list_pujw6_1",op_icon:"_op_icon_pujw6_1",op_text:"_op_text_pujw6_1",op_item:"_op_item_pujw6_1",download:"_download_pujw6_1",play:"_play_pujw6_1",screen:"_screen_pujw6_1","options-wrapper":"_options-wrapper_pujw6_3","xl-chrome-ext-bar-toast":"_xl-chrome-ext-bar-toast_pujw6_15","xl-chrome-ext-bar__logo":"_xl-chrome-ext-bar__logo_pujw6_30","xl-chrome-ext-bar-toast__success":"_xl-chrome-ext-bar-toast__success_pujw6_38","xl-chrome-ext-bar-toast__error":"_xl-chrome-ext-bar-toast__error_pujw6_46","xl-chrome-ext-bar-toast__text":"_xl-chrome-ext-bar-toast__text_pujw6_54","xl-chrome-ext-tips":"_xl-chrome-ext-tips_pujw6_62","xl-chrome-ext-title":"_xl-chrome-ext-title_pujw6_69","xl-chrome-ext-title--footer":"_xl-chrome-ext-title--footer_pujw6_74","xl-chrome-ext-bar__option":"_xl-chrome-ext-bar__option_pujw6_78",img:"_img_pujw6_94","xl-download":"_xl-download_pujw6_101","xl-screen":"_xl-screen_pujw6_105","xl-close":"_xl-close_pujw6_109"},Jt=["onClick"],Ht=["onClick"],Kt=["onClick"],Xt=["onClick"],Qt=te({__name:"VideoTagV1",props:{latestVideoSrc:{type:String,required:!0},latestVideoElement:{type:Object,required:!1,default:()=>({})},exception:{type:Boolean,required:!0},isShowVideoTag:{type:Boolean,required:!0},isShowDownloadBar:{type:Boolean,required:!0},isShowCloudAddBar:{type:Boolean,required:!0},isRiskControlPassed:{type:Boolean,required:!1,default:!1}},emits:["showActionError","showVersionError","handleDownload","handleCloseBar"],setup(e,{emit:a}){const r=a,c=e,_=u(!1),v=u(""),p=u("success"),f=u(null),x=L({isM3U8Video:!1,M3U8VideoUrl:""}),w=t(()=>c.isShowVideoTag&&c.isRiskControlPassed);function y(){if(c.exception)return r("showActionError","下载","download"),void chrome.runtime.sendMessage({name:"xl_download_stat",link:x.M3U8VideoUrl||c.latestVideoSrc,stat:"chrome_download_video",from:"video_hover",status:"fail",videoUIVersion:"v1"});!function(){do{if(!c.latestVideoElement)break;const e=c.latestVideoElement;if(!c.latestVideoSrc)break;let t="",o="";if(document.title){const n=document.title.replace(/[*?/:|<>"]/g,"");n&&(o=P(F(c.latestVideoSrc)),o||(o=S(e)),t=`${n}${o}`)}chrome.runtime.sendMessage({name:"xl_download",link:x.M3U8VideoUrl||c.latestVideoSrc,cookie:document.cookie,referurl:document.location.href,fileName:t,stat:"chrome_download_video",from:"video_hover",isInIframe:N(),isM3U8Video:!!x.M3U8VideoUrl,videoUIVersion:"v1"})}while(0)}()}async function E(){const e=z(x.M3U8VideoUrl||c.latestVideoSrc),t={from:"video_hover",data:{opt:"web:cloudadd",params:{url:e.url,name:e.fileName,ext:e.suffix,isVideo:e.isVideoURL}}};if(N()?t.name="xl_cloudadd_in_iframe":(t.name="xl_cloudadd",t.cookie=document.cookie,t.webTitle=document.title),c.exception)return r("showActionError","流畅播","fluent_play"),void chrome.runtime.sendMessage({name:"xl_cloudadd_stat",from:"video_hover",isSuccess:!1,data:e});const{isAccept:o}=await chrome.runtime.sendMessage({name:"xl_check_blacklist"});if(!o)return chrome.runtime.sendMessage({name:"xl_show_toast",text:"链接异常，无法流畅播。",type:"info"}),void chrome.runtime.sendMessage({name:"xl_cloudadd_stat",from:"video_hover",isSuccess:!1,data:e});chrome.runtime.sendMessage(t,e=>{e&&"version"===e.errType&&r("showVersionError",e.text)})}function M(){if(c.exception)return void r("showActionError","投屏","projection");const e={url:c.latestVideoSrc,name:document.title,playForm:document.referrer,dlnaPlay:!0,stat:"browser_plugin_tv_sp_click"};chrome.runtime.sendMessage({name:"xl_screen",type:"click",videoUIVersion:"v1",data:{opt:"web:play",params:e}},e=>{e&&"version"===e.errType&&r("showVersionError","投屏")})}function S(e){let t=void 0;for(let o=0;o<e.children.length;o++){const n=e.children[o];if("source"===n.tagName.toLowerCase()&&n.type){const e=n.type.split("/");e.length>0&&(t=e[e.length-1]);break}}return t?"."+t:""}function C(){navigator.clipboard?chrome.runtime.sendMessage({name:"xl_copy",text:x.M3U8VideoUrl||c.latestVideoSrc},e=>{e.status&&V({isShow:!0,msg:"复制成功",type:"success"})}):V({isShow:!0,msg:"复制失败",type:"error"})}function V(e){const{isShow:t,msg:o,type:n}=e;_.value=t,v.value=o,p.value=n,f.value&&clearTimeout(f.value),f.value=setTimeout(()=>{_.value=!1},1500)}return m(async()=>{chrome.runtime.sendMessage({name:"xl_screen",type:"init",videoUIVersion:"v1",data:{params:{playForm:document.referrer}}},e=>{x.isM3U8Video=(null==e?void 0:e.isM3U8Video)||!1,x.M3U8VideoUrl=(null==e?void 0:e.M3U8VideoUrl)||""})}),(t,a)=>(o(),n(k,null,[_.value?(o(),n("div",{key:0,class:l([t.$style["xl-chrome-ext-bar-toast"]])},[s("div",{class:l(["success"===p.value?t.$style["xl-chrome-ext-bar-toast__success"]:"","error"===p.value?t.$style["xl-chrome-ext-bar-toast__error"]:""])},null,2),s("div",{class:l([t.$style["xl-chrome-ext-bar-toast__text"]])},d(v.value),3)],2)):i("",!0),g(s("div",{class:l([t.$style["options-wrapper"]])},[s("a",{onClick:a[0]||(a[0]=h(e=>t.$emit("handleCloseBar"),["stop"])),id:"xl_chrome_ext_bar_close",href:"javascript:;"}),s("div",{class:l(t.$style["xl-chrome-ext-bar__logo"])},null,2),e.isShowCloudAddBar?(o(),n("div",{key:0,class:l([t.$style["xl-chrome-ext-tips"],t.$style["cloud-add"]]),onClick:h(E,["stop"])},[s("a",{id:"xl_chrome_ext_bar_cloudAdd",class:l(t.$style["xl-chrome-ext-bar__option"]),href:"javascript:;"},null,2),s("div",{class:l(t.$style["xl-chrome-ext-title"])},"流畅播",2)],10,Jt)):i("",!0),e.isShowDownloadBar?(o(),n("div",{key:1,class:l([t.$style["xl-chrome-ext-tips"],t.$style.download]),onClick:h(y,["stop"])},[s("a",{id:"xl_chrome_ext_bar_download",class:l([t.$style["xl-chrome-ext-bar__option"]]),href:"javascript:;"},null,2),s("div",{class:l([t.$style["xl-chrome-ext-title"]])},"下载视频",2)],10,Ht)):i("",!0),s("div",{onClick:h(M,["stop"]),class:l([t.$style["xl-chrome-ext-tips"]])},[s("a",{id:"xl_chrome_ext_bar_screen",href:"javascript:;",class:l([t.$style["xl-chrome-ext-bar__option"]])},null,2),s("div",{class:l([t.$style["xl-chrome-ext-title"]])},"投屏",2)],10,Kt),s("div",{onClick:h(C,["stop"]),class:l([t.$style["xl-chrome-ext-tips"]])},[s("a",{id:"xl_chrome_ext_bar_copy",class:l([t.$style["xl-chrome-ext-bar__option"]]),href:"javascript:;"},null,2),s("div",{class:l([t.$style["xl-chrome-ext-title"]])},"复制链接",2)],10,Xt)],2),[[b,w.value]])],64))}},[["__cssModules",{$style:Wt}]]),Yt=["onClick"],Zt=te({__name:"VideoTagV2",props:{latestVideoSrc:{type:String,required:!0},latestVideoElement:{type:Object,required:!1,default:()=>({})},exception:{type:Boolean,required:!0},isShowVideoTag:{type:Boolean,required:!0},isShowDownloadBar:{type:Boolean,required:!0},isShowCloudAddBar:{type:Boolean,required:!0},isRiskControlPassed:{type:Boolean,required:!1,default:!1}},emits:["showActionError","showVersionError","handleDownload","handleCloseBar","m3u8VideoUrlChanged","latestVideoSrcChanged"],setup(e,{emit:i}){const a=i,r=e;u(!1),u(""),u("success"),u(null);const c=L({isM3U8Video:!1,M3U8VideoUrl:""}),_=t(()=>r.isShowVideoTag&&r.isRiskControlPassed);m(()=>{}),w(c,e=>{}),w(()=>c.M3U8VideoUrl,(e,t)=>{a("m3u8VideoUrlChanged",e)}),w(()=>r.latestVideoSrc,(e,t)=>{t&&e!==t&&a("latestVideoSrcChanged",e)});const v=u([{text:"下载",id:"download",icon:"download"},{text:"流畅播",id:"play",icon:"play"},{text:"投屏",id:"screen",icon:"screen"}]),p=t(()=>{let e=[...v.value];return r.isShowCloudAddBar||(e=e.filter(e=>"play"!==e.id)),e});function f(e){switch(e.id){case"download":!function(){if(Ot.info("badge tag click"),r.exception)return a("showActionError","下载","download"),void chrome.runtime.sendMessage({name:"xl_download_stat",link:c.M3U8VideoUrl||r.latestVideoSrc,stat:"chrome_download_video",from:"video_hover",status:"fail",videoUIVersion:"v2"});!function(){if(!r.latestVideoElement)return;const e=r.latestVideoElement;if(!r.latestVideoSrc)return;let t="",o="";if(document.title){const n=document.title.replace(/[*?/:|<>"]/g,"");n&&(o=P(F(r.latestVideoSrc)),o||(o=function(e){let t=void 0;for(let o=0;o<e.children.length;o++){const n=e.children[o];if("source"===n.tagName.toLowerCase()&&n.type){const e=n.type.split("/");e.length>0&&(t=e[e.length-1]);break}}return t?"."+t:""}(e)),t=`${n}${o}`)}!function({fileName:e="",link:t=""}){chrome.runtime.sendMessage({name:"xl_download",link:t,fileName:e,cookie:document.cookie,referurl:document.location.href,stat:"chrome_download_video",from:"video_hover",isInIframe:N(),isM3U8Video:!!c.M3U8VideoUrl,videoUIVersion:"v2"})}({link:c.M3U8VideoUrl||r.latestVideoSrc,fileName:t})}()}();break;case"screen":!function(){if(r.exception)return void a("showActionError","投屏","projection");const e={url:r.latestVideoSrc,name:document.title,playForm:document.referrer,dlnaPlay:!0,stat:"browser_plugin_tv_sp_click"};chrome.runtime.sendMessage({name:"xl_screen",type:"click",videoUIVersion:"v2",data:{opt:"web:play",params:e}},e=>{e&&"version"===e.errType&&a("showVersionError","投屏")})}();break;case"play":!async function(){const e=z(c.M3U8VideoUrl||r.latestVideoSrc),t={from:"video_hover",data:{opt:"web:cloudadd",params:{url:e.url,name:e.fileName,ext:e.suffix,isVideo:e.isVideoURL}}};N()?t.name="xl_cloudadd_in_iframe":(t.name="xl_cloudadd",t.cookie=document.cookie,t.webTitle=document.title);if(r.exception)return a("showActionError","流畅播","fluent_play"),void chrome.runtime.sendMessage({name:"xl_cloudadd_stat",from:"video_hover",isSuccess:!1,data:e});const{isAccept:o}=await chrome.runtime.sendMessage({name:"xl_check_blacklist"});if(!o)return chrome.runtime.sendMessage({name:"xl_show_toast",text:"链接异常，无法流畅播。",type:"info"}),void chrome.runtime.sendMessage({name:"xl_cloudadd_stat",from:"video_hover",isSuccess:!1,data:e});chrome.runtime.sendMessage(t,e=>{e&&"version"===e.errType&&a("showVersionError",e.text)})}()}}function x(){chrome.runtime.sendMessage({name:"xl_screen",type:"init",videoUIVersion:"v2",data:{params:{playForm:document.referrer}}}),setTimeout(()=>{c.M3U8VideoUrl||r.latestVideoSrc},2e3)}return m(async()=>{chrome.runtime.onMessage.addListener((e,t,o)=>{var n,l;"newM3u8Request"===e.action&&(c.isM3U8Video=(null==(n=null==e?void 0:e.data)?void 0:n.isM3U8Video)||!1,c.M3U8VideoUrl=(null==(l=null==e?void 0:e.data)?void 0:l.url)||"",x())})}),(e,t)=>g((o(),n("div",{class:l([e.$style.video_op_wrapper])},[s("ul",{class:l(e.$style.video_op_list)},[(o(!0),n(k,null,E(p.value,(t,i)=>(o(),n("li",{key:i,class:l([e.$style.op_item,e.$style[t.id]]),onClick:h(e=>f(t),["stop"])},[s("span",{class:l(e.$style.op_icon)},null,2),s("span",{class:l(e.$style.op_text)},d(t.text),3)],10,Yt))),128))],2)],2)),[[b,_.value]])}},[["__cssModules",{$style:{video_op_wrapper:"_video_op_wrapper_96mx8_1",video_op_list:"_video_op_list_96mx8_17",op_icon:"_op_icon_96mx8_25",op_text:"_op_text_96mx8_31",op_item:"_op_item_96mx8_39",download:"_download_96mx8_45",play:"_play_96mx8_48",screen:"_screen_96mx8_51"}}]]),eo=["id"],to=te({__name:"videoTag",emits:["riskControlChanged"],setup(e,{emit:l}){const i=l,s=u(Z),a=u(null),r=M(),c=u(null),d=u(""),m=t(()=>r.latestVideoSrc);async function _(e="VIDEO_TAG_DOWNLOAD"){try{const e=d.value||window.location.href,t=document.title||"",o=window.location.href||"",n=await async function(){return new Promise(e=>{if(window.self===window.top)return void e("");const t=`parent_title_${Date.now()}_${Math.random()}`;let o=null;const n=l=>{"PARENT_TITLE_RESPONSE"===l.data.type&&l.data.messageId===t&&(window.removeEventListener("message",n),o&&clearTimeout(o),e(l.data.parentTitle||""))};window.addEventListener("message",n),window.parent.postMessage({type:"REQUEST_PARENT_TITLE",messageId:t},"*"),o=setTimeout(()=>{window.removeEventListener("message",n),e("")},1e3)})}(),l=[{url:e,file_name:t,web_title:t+(n?" - "+n:""),referer:o}],i=await ne({name:"RiskCheck",infos:l});if(c.value=i,i&&i.data&&Array.isArray(i.data)){return i.data.every(e=>"SUGGESTION_PASS"===e.suggestion)}return!1}catch(t){return!1}}const v=u(!1),p=t(()=>({...r,isRiskControlPassed:v.value}));async function f(e="VIDEO_TAG_DOWNLOAD"){const t=await _(e);v.value=t,i("riskControlChanged",t)}function h(e){d.value=e,f("VIDEO_TAG_M3U8")}return w(()=>v.value,e=>{i("riskControlChanged",e)},{immediate:!0}),w(()=>m.value,(e,t)=>{e&&e.startsWith("blob:")||(d.value=e,f("VIDEO_TAG_SRC_CHANGE"))}),async function(){try{const e=await ne({name:"GetConfig"});if(e){const t=(null==e?void 0:e.videoTagVersion)||"v2";a.value="v2"===t?Zt:Qt}}catch(e){}}(),f("VIDEO_TAG_INIT"),(e,t)=>(o(),n("div",{id:s.value},[(o(),S(V(a.value),C(p.value,{onM3u8VideoUrlChanged:h}),null,16))],8,eo))}},[["__cssModules",{$style:Wt}]]);function oo(){this.states={},this._current=void 0}oo.prototype.start=function(e){if(void 0!==this._current)throw"State machine already started";if(null==e)throw"Please give a valid state name";setTimeout(oo._changeState,0,this,e)},oo.prototype.fireEvent=function(e,t){if(void 0===this._current)throw"State machine not started";if(null===this._current)throw"State machine terminated";setTimeout(oo._handleEvent,0,this,e,t)},oo._changeState=function(e,t){if(null!==t&&!e.states.hasOwnProperty(t))throw e._current=null,'No such state "'+t+'"';let o=e._current;if(void 0!==o&&o.hasOwnProperty("__exit__")&&o.__exit__.apply(e),null===t)return void(e._current=null);if(o=e._current=e.states[t],!o.hasOwnProperty("__enter__"))return;const n=o.__enter__.apply(e);void 0!==n&&setTimeout(oo._changeState,0,e,n)},oo._handleEvent=function(e,t,o){let n=e._current[t];"function"==typeof n&&(n=n.apply(e,o)),void 0!==n&&setTimeout(oo._changeState,0,e,n)};let no={};const lo={glass:"ncennffkjdiamlpmcbajkmaiiiddgioo-glass",help:"ncennffkjdiamlpmcbajkmaiiiddgioo-help",overlay:"ncennffkjdiamlpmcbajkmaiiiddgioo-overlay"},io={closing:"ncennffkjdiamlpmcbajkmaiiiddgioo-closing",exiting:"ncennffkjdiamlpmcbajkmaiiiddgioo-exiting",inverted:"ncennffkjdiamlpmcbajkmaiiiddgioo-inverted",invisible:"ncennffkjdiamlpmcbajkmaiiiddgioo-invisible",loading:"ncennffkjdiamlpmcbajkmaiiiddgioo-loading",relative:"ncennffkjdiamlpmcbajkmaiiiddgioo-relative",selected:"ncennffkjdiamlpmcbajkmaiiiddgioo-selected",selectionRectangle:"ncennffkjdiamlpmcbajkmaiiiddgioo-selection-rectangle"};function so(){this._invertedSelection=!1,this._curpos={x:0,y:0},this._selectableElements=[],this._visibleElements=[];const e=this,t=document.createElement("div");t.id=lo.overlay;const o=document.createElement("div");o.id=lo.glass;const n=document.createElement("div");n.id=lo.help,n.innerHTML=chrome.i18n.getMessage("usage"),n.onmouseover=function(){n.classList.add(io.invisible)},n.onmouseout=function(){n.classList.remove(io.invisible)};const l=function(e){e.preventDefault(),e.stopPropagation()},i=function(t){e._curpos.x=t.clientX,e._curpos.y=t.clientY};let s=null;const a={contextmenu:function(e){l(e)},mousemove:function(t){i(t),e.sm.fireEvent("mousemove")},mousedown:function(t){if(null===s&&(0==t.button||2==t.button)){switch(s=0==t.button?t.ctrlKey?1:0:2,s){case 0:i(t),e.sm.fireEvent("mousedown");break;case 1:case 2:i(t),e.sm.fireEvent("alt_mousedown")}l(t)}},mouseup:function(t){if(null!==s&&(t.button==s||0==t.button||1==s)){switch(t.button){case 0:i(t),e.sm.fireEvent(1==s?"alt_mouseup":"mouseup");break;case 2:i(t),e.sm.fireEvent("alt_mouseup")}s=null,l(t)}},keydown:function(t){if(t.isTrusted){switch(t.keyCode){case 13:e.sm.fireEvent("req_download");break;case 27:e.sm.fireEvent("req_exit");break;default:return}l(t)}},resize:function(){let t=null;const o=function(){t=null,e.updateVisibleElements()};return function(){null!==t&&clearTimeout(t),t=setTimeout(o,100)}}(),scroll:function(){let t=null;const o=function(){t=null,e.updateVisibleElements()};return function(){null!==t&&clearTimeout(t),t=setTimeout(o,100)}}()};document.addEventListener("contextmenu",a.contextmenu),document.addEventListener("scroll",a.scroll),window.addEventListener("resize",a.resize),document.addEventListener("keydown",a.keydown,!0),document.body.addEventListener("mousedown",a.mousedown,!0),document.body.addEventListener("mouseup",a.mouseup,!0),t.appendChild(n),t.appendChild(o);const r=new oo;r.states.load={__enter__:function(){document.documentElement.classList.add(io.loading),document.body.appendChild(t),t.addEventListener("webkitTransitionEnd",(function o(){t.removeEventListener("webkitTransitionEnd",o),e.sm.fireEvent("load_done")})),setTimeout((function(){e.populate(),e.updateVisibleElements(),document.documentElement.classList.remove(io.loading)}),0)},load_done:"idle"},r.states.exit={__enter__:function(){e._cursel&&m(),document.removeEventListener("mousemove",a.mousemove),document.removeEventListener("scroll",a.scroll),window.removeEventListener("resize",a.resize),document.removeEventListener("contextmenu",a.contextmenu),document.removeEventListener("keydown",a.keydown,!0),document.body.removeEventListener("mousedown",a.mousedown,!0),document.body.removeEventListener("mouseup",a.mouseup,!0),e._selectableElements.forEach((function(e){e._private.delegate.classList.remove(io.selected),e._private.delegate.classList.remove(io.relative),delete e._private}));const o=()=>{t.removeEventListener("webkitTransitionEnd",o),document.body.removeChild(t),document.documentElement.classList.remove(io.exiting),e.sm.fireEvent("exit_done")};t.addEventListener("webkitTransitionEnd",o),document.documentElement.classList.add(io.exiting)},__exit__:function(){no.instance=null},exit_done:null},r.states.idle={mousedown:"selection",alt_mousedown:"deselection",req_exit:"exit",req_download:"action-download"};let c=null,d=null;const u=function(){const t=document.createElement("div");t.classList.add(io.selectionRectangle),t.style.left=e._curpos.x+"px",t.style.top=e._curpos.y+"px",e._invertedSelection&&t.classList.add(io.inverted),e._cursel=document.body.appendChild(t),e._startpos={x:e._curpos.x,y:e._curpos.y},e._selrect={x:e._curpos.x,y:e._curpos.y,w:0,h:0},e._lastDrawn={},c=setInterval(e.drawSelection.bind(e),30),d=setInterval(e.calcSelectedElements.bind(e),30),document.addEventListener("mousemove",a.mousemove)},m=function(){document.removeEventListener("mousemove",a.mousemove),clearInterval(c),clearInterval(d),c=null,d=null,e.calcSelectedElements();for(const t in e._selectableElements){const o=e._selectableElements[t]._private;o.selected=o.selected2}return e._cursel.addEventListener("webkitTransitionEnd",function(){document.body.removeChild(this)}.bind(e._cursel)),e._cursel.classList.add(io.closing),delete e._cursel,delete e._startpos,delete e._selrect,delete e._lastDrawn,"idle"},_=function(){if(!e._startpos)return;const t=e._startpos,o=e._curpos,n=e._selrect;n.x=Math.min(t.x,o.x),n.y=Math.min(t.y,o.y),n.w=Math.abs(t.x-o.x),n.h=Math.abs(t.y-o.y)};r.states.selection={__enter__:function(){e._invertedSelection=!1,u()},mousemove:_,mouseup:m,req_exit:"exit"},r.states.deselection={__enter__:function(){e._invertedSelection=!0,u()},mousemove:_,alt_mouseup:m,req_exit:"exit"},r.states["action-download"]={__enter__:function(){const t=function(e){const t={};return e.forEach((function(e){if(e._private.selected){const o=function(e){let t=e.href;do{const o=e.getAttribute("thunderhref");if(o){t=o;break}if(null===e.getAttribute("thundertype"))break;const n=e.attributes.length;if(n<=0)break;for(let l=0;l<n;l++){const o=e.attributes[l].value;if(o&&0===o.toLowerCase().indexOf("thunder://")){t=o;break}}}while(0);return t}(e);t[o]=null}})),Object.keys(t)}(e._selectableElements);chrome.runtime.sendMessage({name:"xl_download_multi",referurl:document.location.href,cookie:document.cookie,urls:t}),e.sm.fireEvent("done")},done:"exit"},this.sm=r}function ao(e,t){for(const o in e)e[o].classList.add(io.selected);for(const o in t)t[o].classList.remove(io.selected)}function ro(e,t){return!(e.bottom<t.y||t.y+t.h<e.top||e.right<t.x||t.x+t.w<e.left)}so.prototype.populate=function(){const e=document.links,t=/^javascript:/;for(let o=0;o<e.length;o++){const n=e[o];if(null==n.href||t.test(n.href))continue;let l=n;const i=n.getElementsByTagName("img");i.length&&(l=i[0]),n._private={selected:!1,selected2:!1,delegate:l,positionfix:!1},this._selectableElements.push(n)}},so.prototype.updateVisibleElements=function(){const e={x:0,y:0,w:window.innerWidth,h:window.innerHeight},t=this._visibleElements,o=this._selectableElements;t.splice(0);for(const n in o){const l=o[n],i=l._private,s=i.delegate;ro(s.getBoundingClientRect(),e)&&(t.push(l),i.positionfix||(i.positionfix=!0,"static"==window.getComputedStyle(s).position&&s.classList.add(io.relative)))}},so.prototype.drawSelection=function(){const e=this._selrect,t=this._lastDrawn,o=this._cursel.style;e.x==t.x&&e.y==t.y&&e.w==t.w&&e.h==t.h||(o.left=(t.x=e.x)+"px",o.top=(t.y=e.y)+"px",o.width=(t.w=e.w)+"px",o.height=(t.h=e.h)+"px")},so.prototype.calcSelectedElements=function(){const e=this._visibleElements,t=this._selrect,o=[],n=[];for(const l in e){const i=e[l]._private,s=i.delegate,a=i.delegate.getClientRects();let r=!1;for(let e=0;e<a.length;e++){if(ro(a[e],t)){r=!0;break}}const c=r?!this._invertedSelection:i.selected;c!=i.selected2&&((c?o:n).push(s),i.selected2=c)}(o||n)&&setTimeout(ao,0,o,n)},no={instance:null,enter:function(){null===no.instance&&(no.instance=new so,no.instance.sm.start("load"),chrome.runtime.sendMessage({name:"xl_download_multi_start",referurl:document.location.href}))},quit:function(){no.instance&&no.instance.sm.fireEvent("req_exit")},download:function(){no.instance&&no.instance.sm.fireEvent("req_download")}};const co=no,uo=te({__name:"content-win",setup(e){const t="xl_chrome_ext_"+ee;u(null),u(null),u(null);const s=u({}),a=u(!1),r=u("v2"),c=u(""),d=u({}),p=u(!1),h=u(!1),x=u(!1),y=u(!1),g=u(!1),b=u(!1),k=u("");u(null);const E=u(!1),M=u(!1),C=u(!1),V=u(!1),T=u(!1),U=u(""),q=u(""),j=u(""),I=u(!1),O=u(""),B=u(!1),R=u(null),D=u(!1),P=u(null),F=L({isM3U8Video:!1,M3U8VideoUrl:""}),te=L({downloadList:[],playList:{M3U8List:[],normalVideoList:[],length:0},saveList:[],length:0});let oe,ie,se,pe,fe,he,xe=!1,ye=!1,ge=!1,be=!1,ke=!1,Ee=!0,Le=!0,Me=!1,Se=null,Ce=[],Ve=new Set,Te=null,Ue=null;function qe(e){E.value=!1,Je({action:e,source:q.value,stat:"xl_action_error"})}function $e(e){qe(e)}function je(e){T.value=!1,Je({action:e})}function Ie(e){je(e)}function Oe(e){h.value=e}function Ae(e){I.value=!1,Je({action:e,stat:"xl_reminder_install"})}function Be(e){Ae(e)}function Re(){I.value=!0,chrome.runtime.sendMessage({name:"xl_prompt_show"})}function Ne(e){T.value=!0,j.value=e}function De(){M.value=!1,nt(),x.value=!0,chrome.runtime.sendMessage({name:"xl_screen",type:"close",stat:"browser_plugin_close_click",videoUIVersion:r.value})}function Pe(e,t){return 0!=e.length&&(0!=be&&(0!=function(e){if(0==e.length)return!1;const t=e,o=t.indexOf(":");if(-1==o)return!1;const n=t.substr(0,o+1).toUpperCase();if(""==n)return!1;let l=!0;return-1!=X.indexOf(n)?0==xe&&(l=!1):-1!=Q.indexOf(n)?0==ye&&(l=!1):-1!=Y.indexOf(n)?0==ge&&(l=!1):l=!1,l}(e)&&(0!=function(e){if(0==e.length)return!0;const t=[],o=pe.split("||");for(const i in o){const e=o[i].slice(2).trimRight("|");t.push(e)}let n=!0;const l=e;for(const i in t)if(t[i].length>0&&-1!=l.indexOf(t[i])){n=!1;break}return n}(t)&&(!_e(t,fe)&&0!=function(e){if(0==e.length)return!1;const t=e.indexOf(":");if(-1==t)return!1;const o=e.toLowerCase();if("xlapp://"==o.substr(0,t+3).trimLeft(" "))return!0;if(-1!=o.indexOf("ed2k://")||-1!=o.indexOf("magnet:?"))return!0;let n=!1,l=ve(o);return l.length>0&&(l+=";",-1!=he.indexOf(l)&&(n=!0)),n}(e)))))}function ze(e){return t=e,document.cookie,o=document.location.href,!me(t)&&Pe(t,o);var t,o}function Ge(e){var t;if(e.ctrlKey)return;if(!e.isTrusted)return;const o=(null==(t=null==e?void 0:e.target)?void 0:t.href)||"";if(oe&&ie&&se){let t=ue(o);if(null!=t)return;if(t=ze(o),t)return chrome.runtime.sendMessage({name:"xl_download",link:o,cookie:document.cookie,referurl:document.location.href}),e.stopPropagation(),void e.preventDefault()}else B.value&&((n=(n=o).toLowerCase()).startsWith("thunder://")||n.startsWith("ed2k://")||n.startsWith("magnet:?")||n.includes(".torrent"))&&chrome.runtime.sendMessage({name:"xl_prompt_enable"},(function(e){e&&e.enable&&Re()}));var n}function We(){$.info("RegisterClickEventListener",y.value,document.links);const e=e=>{Ge(e)};if(y.value)for(const t of document.links)t.addEventListener("click",e,!1);else for(const t of document.links)t.outerHTML.match(W),t.addEventListener("click",e,!1)}function He(){document.getElementById(t);M.value=!1}async function Ke(e){do{if(x.value)break;const{M3U8VideoUrl:o}=F,n=document.getElementById(t),l=z(o||O.value);n.style.display="block";const i=n.querySelector(".xl-chrome-ext-tips.cloud-add"),s=n.querySelector(".xl-chrome-ext-tips.download"),a=J(Te,l.suffix,l.protocol),c=J(Ue,l.suffix,l.protocol);i&&!a&&(V.value=!1),s&&!c&&(C.value=!1);const d=e.getBoundingClientRect();let u="position: fixed !important; z-index: 10000000000 !important;";u+=`left: ${d.x+4}px; top: ${d.y+4}px;`,b.value&&(k.value=`top:${d.y+16}px`),n.style=u,ke||(ke=!0,chrome.runtime.sendMessage({name:"VideoShow",referurl:document.location.href,hasDownload:c,videoSrc:e.src,videoUIVersion:r.value},(function(){}))),M.value=!0,H(n)}while(0)}function Xe(e){e.isTrusted&&(e.ctrlKey&&chrome.runtime.sendMessage({name:"EnabledCapture",capture:!1},(function(){})),window.top!==window.self&&chrome.runtime.sendMessage({name:"xl_chrome_iframe_keydown",keyCode:e.keyCode}))}function Qe(e){if(e.isTrusted&&(e.ctrlKey&&chrome.runtime.sendMessage({name:"EnabledCapture",capture:!0},(function(){})),Le))switch(e.keyCode){case 68:e.shiftKey&&(ae()||oe&&(window.top===window.self?co.enter():chrome.runtime.sendMessage({name:"xl_chrome_iframe_multi_hotkey"})))}}function Ze(e){var t,o;try{const n=document.elementFromPoint(e.x,e.y);do{if(!n)break;if(null==(t=null==n?void 0:n.tagName)||t.toUpperCase(),"VIDEO"===(null==(o=null==n?void 0:n.tagName)?void 0:o.toUpperCase())){const{isM3U8Video:e}=F,t=n.src||re(n,e);if(!t)break;if(0===(null==t?void 0:t.toLowerCase().indexOf("blob:"))&&!e)break;if(n===R.value)break;R.value=n,O.value=t||"",Ke(n);break}if(R.value){if(!ce(e,R.value)){R.value=null,O.value="",He();break}}else{const t=document.getElementsByTagName("video");if(Ce=t,0===Ce.length)break;let o=null;for(let n=0;n<Ce.length;n++){const t=Ce[n];if("none"!==window.getComputedStyle(t).display)if(ce(e,t))if(o){const e=Number(window.getComputedStyle(t).zIndex)||0;e>(Number(window.getComputedStyle(o).zIndex)||0)&&(o=t)}else o=t;else if(o)break}if(o){const e=o.src||re(o),{isM3U8Video:t}=F;(e&&0!==e.toLowerCase().indexOf("blob:")||t)&&(R.value=o,O.value=e,Ke(o));break}}}while(0)}catch(n){}}function et(e){var t;const o=null==(t=document.getElementById(Z))?void 0:t.contains(e.toElement);R.value&&(o||(R.value=null,O.value="",He()))}function tt(e){Ze(e)}function ot(){R.value&&Ke(R.value)}function nt(){!function(){try{document.body&&(document.body.removeEventListener("mousemove",Ze,!0),window.self!==window.top&&document.body.removeEventListener("mouseout",et),document.body.removeEventListener("wheel",tt)),document.removeEventListener("mousemove",Ze,!0),window.self!==window.top&&document.removeEventListener("mouseout",et),document.removeEventListener("wheel",tt),document.removeEventListener("scroll",ot)}catch(e){}}(),R.value=null,O.value="",Ce=[],Se&&(Se.disconnect(),Se=null)}function lt(){return window.top===window.self}function it(e){if("data"===e.data.type&&lt())try{const t=JSON.parse(e.data.payload);Object.assign(te,{...t}),a.value=!0}catch(t){}}function st(e,t){chrome.runtime.sendMessage({name:"xl_show_action_error_dialog",source:t}),E.value=!0,U.value=e,q.value=t}function at(){Ee&&Me&&!x.value&&(nt(),async function(){do{if(Se)break;let t=null;try{t=window.top.document.getElementsByTagName("title")[0]}catch(e){}t&&(Se=new MutationObserver((function(){const e=document.getElementsByTagName("video");Ce=e})),Se.observe(t,{childList:!0})),Ce=await K(),A(Ce)}while(0)}(),function(){try{document.body?(document.body.addEventListener("mousemove",Ze,!0),window.self!==window.top&&document.body.addEventListener("mouseout",et),document.body.addEventListener("wheel",tt)):(document.addEventListener("mousemove",Ze,!0),window.self!==window.top&&document.addEventListener("mouseout",et),document.addEventListener("wheel",tt)),document.addEventListener("scroll",ot)}catch(e){}}())}function rt(){chrome.runtime.onMessage.addListener((e,t,o)=>{"newM3u8Request"===e.action&&(F.isM3U8Video=e.data.isM3U8Video,F.M3U8VideoUrl=e.data.url,chrome.runtime.sendMessage({name:"xl_screen",type:"init",data:{params:{playForm:document.referrer}}}))})}w(y,()=>{We()}),w(p,e=>{e&&chrome.runtime.sendMessage({name:"xl_stat",eventId:974,extParam:{tabUrl:window.location.href}})});const ct=async()=>{const e=de();Ve=e instanceof Set?e:new Set;0!==(await async function(){return new Promise(e=>{Ve instanceof Set||(Ve=new Set);for(const t of Ve){const o=z(t)||{},{suffix:n,isVideoURL:l,protocol:i}=o,s=J(Te,n,i),a=J(Ue,n,i);let r=!1;if(("unknown"!==n||i)&&(a&&(te.downloadList.push(o),r=!0),s&&(l&&(te.playList[".m3u8"===n?"M3U8List":"normalVideoList"].push(o),te.playList.length+=1),te.saveList.push(o),r=!0),r&&(te.length+=1),99===te.length))return void e(te)}setTimeout(()=>{const{M3U8VideoUrl:t}=F;if(t){if(te.downloadList.some(e=>e.url===t))return void e(te);const o=z(t);if(!J(Te,o.suffix,o.protocol)||!J(Ue,o.suffix,o.protocol))return;te.downloadList.unshift(o),te.playList.M3U8List.unshift(o),te.saveList.unshift(o),te.playList.length+=1,te.length+=1}e(te)},1500)})}()).length&&(lt()?(a.value=!0,$.warn("页面底部弹出资源列表，",JSON.stringify(te||{}),"非iframe")):($.warn("在 iframe 內部， 向上传递数据：",JSON.stringify(te)),window.parent.postMessage({type:"data",payload:JSON.stringify(te)},"*")))};function dt(){a.value=!1}const ut=async()=>{var e;D.value=!0,e=document.location.href,chrome.runtime.sendMessage({name:"CheckActivated",url:e}),We(),function(e){chrome.runtime.sendMessage({name:"CheckVideoInWhiteList",url:e},(async function(e){var t,o;B.value=null==e?void 0:e.exception,Me=null==e?void 0:e.videoInWhiteList,oe=null==e?void 0:e.bPlugin,Ee=null==e?void 0:e.bMonitorVideo,ie=null==e?void 0:e.bWebsite,Te=(null==e?void 0:e.fluentPlayConfig)||{},V.value=!!(null==(t=null==e?void 0:e.fluentPlayConfig)?void 0:t.switch),Ue=(null==e?void 0:e.downloadSniffConfig)||{},C.value=!!(null==(o=null==e?void 0:e.downloadSniffConfig)?void 0:o.switch),Me&&Ee&&ie&&(at(),((null==Te?void 0:Te.switch)||(null==Ue?void 0:Ue.switch))&&ct(),!oe&&y.value&&await G()&&chrome.runtime.sendMessage({name:"xl_show_notifications"}))}))}(document.location.href),document.addEventListener("keydown",Xe),document.addEventListener("keyup",Qe,!0),window.addEventListener("message",it),window.addEventListener("message",mt),async function(){var e;try{const t=await ne({name:"GetConfig"});if(!t)return void(s.value={});s.value=t,xe=t.bMonitorEmule,ye=t.bMonitorMagnet,ge=t.bMonitorTradition,be=t.bMonitorIE,pe=t.monitorDomains,fe=t.filterDomains,he=t.monitorFileExts,g.value=le(window.location.href,t.jsqConfig),d.value=(null==(e=null==t?void 0:t.jsqConfig)?void 0:e.text)||{},p.value=t.isStatGlobal,r.value=(null==t?void 0:t.videoTagVersion)||we,$.info("视频操作按钮UI版本",r.value)}catch(t){s.value={}}}()};function mt(e){"REQUEST_PARENT_TITLE"===e.data.type&&e.data.messageId&&e.source.postMessage({type:"PARENT_TITLE_RESPONSE",messageId:e.data.messageId,parentTitle:document.title||""},"*")}return chrome.runtime.onMessage.addListener((function(e,t,o){if("UpdatePluginEnabled"==e.name)B.value=e.exception,oe=e.enable,oe||co.quit();else if("UpdateMoniterVideoTags"==e.name)Ee=e.enable;else if("UpdateMultiSelectShortcutEnable"==e.name)Le=e.enable;else if("UpdateWebsiteEnabled"==e.name)ie=e.enable;else if("UpdatePageEnabled"==e.name)se=e.enable;else if("OnActivated"==e.name)D.value&&async function(e,t,o){try{const n=await chrome.runtime.sendMessage({name:"CheckEnabled",url:e,tabId:t,topFrame:o});if(oe=n.bPlugin,Ee=n.bMonitorVideo,ie=n.bWebsite,se=n.bPage,Le=n.bShortcutEnable,y.value=n.isShowRecallInfo,!Ee||!ie)return void nt();at()}catch(n){}}(document.location.href,e.tabId,window.top===window.self);else if("UpdateMonitorDomains"==e.name)pe=e.monitorDomains;else{if("GetCookie"==e.name)return o({cookie:document.cookie}),!0;if("ThunderSupportReminder"===e.name)window.self===window.top&&Re(e.text);else if("EnterMultiSelect"===e.name){if(N())return;co.enter()}else if("xl_chrome_iframe_keydown"===e.name){if(window.top===window.self)switch(e.keyCode){case 13:co.download();break;case 27:co.quit()}}else if("xl_chrome_iframe_multi_hotkey"===e.name)window.top===window.self&&co.enter();else if("GetAllImages"===e.name){if(window.top===window.self){const e=[];for(const t of document.images)t.src&&e.push({src:t.src,width:t.width,height:t.height,naturalWidth:t.naturalWidth,naturalHeight:t.naturalHeight});return o(e),!0}}else"xl_recall_entry_click"===e.name||"appendFooterUI"===e.name&&(a.value=!0)}})),m(async()=>{ut(),rt()}),_(()=>{try{window.removeEventListener("message",it),document.removeEventListener("keydown",Xe),document.removeEventListener("keyup",Qe,!0),document.body&&(document.body.removeEventListener("mousemove",Ze,!0),lt()||document.body.removeEventListener("mouseout",et),document.body.removeEventListener("wheel",tt)),document.removeEventListener("scroll",ot)}catch(e){}}),(e,t)=>{var r;return o(),n("div",{class:l(e.$style.content_wrapper),ref_key:"panelRef",ref:P},[v(to,{config:s.value,uiVersion:(null==(r=s.value)?void 0:r.videoTagVersion)||"v2",exception:B.value,latestVideoSrc:O.value,isShowVideoTag:M.value,isShowDownloadBar:C.value,isShowCloudAddBar:V.value,latestVideoElement:R.value,onShowActionError:st,onShowVersionError:Ne,onHandleCloseBar:De,onRiskControlChanged:Oe},null,8,["config","uiVersion","exception","latestVideoSrc","isShowVideoTag","isShowDownloadBar","isShowCloudAddBar","latestVideoElement"]),v(Bt,{onShowActionError:st,exception:B.value},null,8,["exception"]),I.value?(o(),S(f(It),{key:0,onSubmit:Be,onCancel:Ae})):i("",!0),E.value?(o(),S(f(Ye),{key:1,text:U.value,onSubmit:$e,onCancel:qe},null,8,["text"])):i("",!0),T.value?(o(),S(f(Gt),{key:2,text:j.value,onSubmit:Ie,onCancel:je},null,8,["text"])):i("",!0),a.value?(o(),S(f(Tt),{key:3,tabUrl:c.value,isShowJsqEntry:g.value,jsqText:d.value,onRemoveFooter:dt,onShowActionError:st,resourceList:te,exception:B.value,isRiskControlPassed:h.value},null,8,["tabUrl","isShowJsqEntry","jsqText","resourceList","exception","isRiskControlPassed"])):i("",!0),v(Fe)],2)}}},[["__cssModules",{$style:{"content-wrapper":"_content-wrapper_20md8_1","xl-chrome-ext-bar-toast":"_xl-chrome-ext-bar-toast_20md8_1","options-wrapper":"_options-wrapper_20md8_7"}}]]),mo="xl_chrome_ext_"+ee;let _o=!1;function vo(){if(document.getElementById(mo))return;const e=document.createElement("div");e.className="xl-chrome-ext-bar_"+ee,e.style.display="block",e.id=mo,document.documentElement.appendChild(e)}try{$.warn(""+(window.self===window.top?"window top":"window iframe")),vo(),po(),_o=!0,$.info("mounted root success")}catch(fo){$.error("error",fo),_o=!1}function po(){j?T(We).mount("#"+mo):T(uo).mount("#"+mo)}window.addEventListener("load",()=>{setTimeout(()=>{_o||(vo(),po(),_o=!0)},0)});
